{% extends 'terapeuta_base.html' %}
{% load static %}

{% block extra_head %} 
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
    <link rel="stylesheet" href="{% static 'css/paciente_terapeuta.css' %}">
{% endblock %}

{% block title %}Pacientes{% endblock %}

{% block header %}
    <div class="contenedor-header">
        <h1>Pacientes</h1>
        <form method="GET" action="{% url 'paciente_terapeuta' %}" class="search-container">
            <input type="text" name="search" placeholder="Búsqueda por Nombre, Rut o Tratamiento" class="search-bar" id="searchBar" value="{{ request.GET.search|default:'' }}" oninput="toggleClearButton()">
            <img src="{% static 'icons/Lupa.svg' %}" alt="Buscar" class="search-icon">
            
            <button type="button" id="clearButton" class="clear-button" onclick="clearSearch()" style="display: {% if request.GET.search %}inline-block{% else %}none{% endif %};">
                Limpiar Filtro
            </button>
        </form>
    </div>
{% endblock %}


{% block content %}
<div class="container">
    <!-- Cabecera de la tabla de pacientes -->
    <div class="titulos-atributos">
        <h2 class="nombre">Nombre</h2>
        <h2 class="rut">Rut</h2>
        <h2 class="edad">Edad</h2>
        <h2 class="tratamiento">Tratamiento</h2>
    </div>
    
    <!-- Lista de pacientes -->
    {% if pacientes %}
    <div class="li-container">
        <ul id="pacienteList">
            {% for paciente in pacientes %}
            <li class="paciente">
                <div class="paciente-info">
                    <p class="nombre">{{ paciente.first_name }} {{ paciente.last_name }}</p>
                    <p class="rut">{{ paciente.rut }}</p>
                    <p class="edad">{{ paciente.edad }} años</p>
                    <p class="tratamiento">{{ paciente.patologia }}</p>
                    <a href="#" class="report-button">
                        <img src="{% static 'icons/Tabla de reportes.svg' %}" alt="Tabla de reportes" class="report-icon">
                    </a>
                </div>
            </li>
            {% empty %}
            <li>No hay pacientes ingresados.</li>
            {% endfor %}
        </ul>
    </div>
    {% else %}
    <!-- Mensaje de no coincidencias -->
    <div class="no-results">
        <p>No se encontraron pacientes que coincidan con la búsqueda.</p>
    </div>
    {% endif %}
    
    <!-- Paginación -->
{% if total_pacientes > 6 %}
<div class="pagination">
    {% if pacientes.has_previous %}
        <a href="?search={{ request.GET.search }}&page={{ pacientes.previous_page_number }}" class="prev-button">
            <img src="{% static 'icons/chevron-left-solid.svg' %}" alt="Anterior" class="previous-icon">
        </a>
    {% endif %}
    <span id="pageNumber">{{ pacientes.number }}</span>
    {% if pacientes.has_next %}
        <a href="?search={{ request.GET.search }}&page={{ pacientes.next_page_number }}" class="next-button">
            <img src="{% static 'icons/chevron-right-solid.svg' %}" alt="Siguiente" class="next-icon">
        </a>
    {% endif %}
</div>
{% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/buscar_paciente.js' %}"></script>
{% endblock %}
